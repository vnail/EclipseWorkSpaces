<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="styles/login.css"/>

<!--引入jquery  -->
<script type="text/javascript" src="scripts/jquery.min.js"></script>
<script type="text/javascript" src="scripts/basevalue.js"></script>
<script type="text/javascript" src="scripts/cookie_util.js"></script>
<script src="scripts/login.js" type="text/javascript"></script>
<script type="text/javascript">
     //主处理方法
     $(function(){ //加载完body后调用该函数
    	 //登录功能事件绑定
    	 $("#login").click(userLogin);	
        /*  $("#sig_in").click(function(){
        	 
         }) */
         //注册功能事件绑定
         $("#regist_button").click(function(){
        	 //测试绑定事件alert("等待实现注册功能");
        	 var name = $("#regist_username").val().trim();
        	 var nickname = $("#nickname").val().trim();
        	 var password = $("#regist_password").val().trim();
        	 var final_password = $("#final_password").val().trim();
        	
        	 var ok=true;
        	 //数据格式检查:不让无效的数据进入服务器
        	 //检查用户
        	 if(name==""){
        		 ok=false;
        		 $("#warning_1 span").html("用户名不能为空");
        		 $("#warning_1").show();
        	 }
        	 //检测密码：1-非空 2-不能小于6位
        	 if(password==""){
        		 ok=false;
        		 $("#warning_2 span").html("密码不能为空");
        		 $("#warning_2").show();
        	 }else if(password.length>0&&password.length<6){
        		 
        		 ok=false;
        		 $("#warning_2 span").html("密码长度不能小于6位");
        		 $("#warning_2").show();
        	 }
        	 //检测确认密码：1-非空 2-是否与密码一致
        	 if(password!=final_password){
        		 ok=false;
        		 $("#warning_3 span").html("密码与确认密码不一致");
        		 $("#warning_3").show();
        	 }
        	 
        	 
        	 if(ok==true){
        		 $.ajax({url:path+"/user/add.do",
        				 type:"post",
        				 data:{"name":name,"nick":nickname,
        					    "password":password},
        				 dataType:"JSON",
        				 success:function(result){
        					 alert(result.status);
        					 //注册成功
        					 if(result.status==0){
        						 alert(result.msg);
        						 $("back").click();
        					 }else if(result.status==1){
        						 alert(result.msg);
        						 //用户名被占用
        						 $("#warning_1 span").html(result.msg);
        						 $("#warning_1").show();
        					 }
        				 },
        				 error:function(){
        					 alert("注册失败");}
        				 });
        	 }
         });
     })
</script>
</head>
	<body>
		<div class="global">
			<div class="log log_in" tabindex='-1' id='dl'>
				<dl>
					<dt>
						<div class='header'>
							<h3>登&nbsp;录</h3>
						</div>
					</dt>
					<dt></dt>
					<dt>
						<div class='letter'>
							用户名:&nbsp;<input type="text" name="" id="count" tabindex='1'/>
							<span id="count_span"></span>
						</div>
					</dt>
					<dt>
						<div class='letter'>
							密&nbsp;&nbsp;&nbsp;码:&nbsp;<input type="password" name="" id="password" tabindex='2'/>
							<span id="password_span"></span>
						</div>
					</dt>
					<dt>
						<div>
							<input type="button" name="" id="login" value='&nbsp登&nbsp录&nbsp' tabindex='3'/>
							<input type="button" name="" id="sig_in" value='&nbsp注&nbsp册&nbsp' tabindex='4'/>
						</div>
					</dt>
				</dl>
			</div>
			<div class="sig sig_out" tabindex='-1' id='zc' style='visibility:hidden;'>
				<dl>
					<dt>
						<div class='header'>
							<h3>注&nbsp;册</h3>
						</div>
					</dt>
					<dt></dt>
					<dt>
						<div class='letter'>
							用户名:&nbsp;<input type="text" name="" id="regist_username" tabindex='5'/>
							<div class='warning' id='warning_1'><span>该用户名不可用</span></div>
						</div>
					</dt>
					<dt>
						<div class='letter'>
							昵&nbsp;&nbsp;&nbsp;称:&nbsp;<input type="text" name="" id="nickname" tabindex='6'/>
						</div>
					</dt>
					<dt>
						<div class='letter'>
							密&nbsp;&nbsp;&nbsp;码:&nbsp;<input type="password" name="" id="regist_password" tabindex='7'/>
							<div class='warning' id='warning_2'><span>密码长度过短</span></div>
						</div>
					</dt>
					<dt>
						<div class='password'>
							&nbsp;&nbsp;&nbsp;确认密码:&nbsp;<input type="password" name="" id="final_password" tabindex='8'/>
							<div class='warning' id='warning_3'><span>密码输入不一致</span></div>
						</div>
					</dt>
					<dt>
						<div>
							<input type="button" name="" id="regist_button" value='&nbsp注&nbsp册&nbsp' tabindex='9'/>
							<input type="button" name="" id="back" value='&nbsp返&nbsp回&nbsp' tabindex='10'/>
							<script type="text/javascript">
							function get(e){
								return document.getElementById(e);
							}
							get('sig_in').onclick=function(){
								get('dl').className='log log_out';
								get('zc').className='sig sig_in';
							}
							get('back').onclick=function(){
								get('zc').className='sig sig_out';
								get('dl').className='log log_in';
							}
							window.onload=function(){
								var t =setTimeout("get('zc').style.visibility='visible'",800);
								get('final_password').onblur=function(){
									var npassword=get('regist_password').value;
									var fpassword=get('final_password').value;
									if(npassword!=fpassword){
										get('warning_3').style.display='block';
									}
								}
								get('regist_password').onblur=function(){
									var npassword=get('regist_password').value.length;
									if(npassword<6&&npassword>0){
										get('warning_2').style.display='block';
									}
								}
								get('regist_password').onfocus=function(){
									get('warning_2').style.display='none';
								}
								get('final_password').onfocus=function(){
									get('warning_3').style.display='none';
								}
							}
							</script>
						</div>
					</dt>
				</dl>
			</div>
		</div>
	</body>
</html>